import{L as R,B as g,R as I,r as x,o as L,M as T,c as i,b as e,x as y,d as F,w as M,e as S,g as $,t as r,q as A,v as q,n as f,y as w,z as N,D as U,m as u}from"./index-CHW42hPp.js";import{u as j}from"./toast-DZktrDzS.js";const H={class:"flex items-center mb-6"},O={key:0,class:"bg-white shadow rounded-lg p-6 text-center text-gray-500"},W={key:1,class:"bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded-md"},P={class:"flex"},X={class:"text-sm text-red-700"},G={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},J={class:"md:col-span-1"},K={class:"bg-white shadow rounded-lg overflow-hidden"},Q={class:"p-4 space-y-3"},Y={class:"grid grid-cols-2 gap-2"},Z={class:"text-xs font-medium text-gray-800"},ee={class:"text-xs font-medium text-gray-800"},te={class:"text-xs font-bold text-blue-600"},se={class:"bg-white mt-6 shadow rounded-lg overflow-hidden"},ae={class:"p-4 space-y-3"},oe={class:"grid grid-cols-2 gap-2"},re={class:"text-xs font-medium text-gray-800"},ne={class:"text-xs font-medium text-gray-800"},le={class:"text-xs font-medium text-gray-800"},ie={class:"md:col-span-2"},ue={class:"bg-white shadow rounded-lg overflow-hidden"},de={class:"p-6"},ce={class:"mb-4"},me={class:"mt-1 relative rounded-md shadow-sm"},pe=["max","disabled"],ve={key:0,class:"mt-1 text-xs text-red-600"},xe={key:1,class:"mt-1 text-xs text-blue-600"},ge={class:"mb-4"},fe=["disabled"],be={class:"mb-4"},ye=["disabled"],we={class:"mt-6 flex justify-end"},he=["disabled"],_e={class:"flex items-center"},ke={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Me={__name:"SavingsWithdrawView",setup(Ce){const z=R(),h=T(),p=I(),d=j(),c=z.params.id;g(()=>p.getters["savings/isLoading"]);const s=g(()=>p.getters["savings/getAccount"]),_=g(()=>p.getters["savings/getError"]),a=x({amount:"5000",description:"Retrait en espèces par le client",payment_method:"cash",transaction_date:new Date().toISOString().split("T")[0]}),n=x({}),m=x(!1);L(async()=>{await D()});const b=x(!1),l=x(""),D=async()=>{b.value=!0,l.value="";try{if(await p.dispatch("savings/fetchAccount",c),_.value){l.value=_.value,d.error("Erreur lors du chargement des informations du compte");return}s.value&&s.value.status!=="active"&&(l.value="Ce compte n'est pas actif. Les retraits ne sont autorisés que sur les comptes actifs.",d.error(l.value),h.push(`/savings/${c}`))}catch(o){console.error("Erreur lors du chargement du compte:",o),l.value="Une erreur est survenue lors du chargement des informations du compte",d.error(l.value)}finally{b.value=!1}},E=async()=>{if(n.value={},!a.value.amount||parseFloat(a.value.amount)<=0){n.value.amount="Veuillez entrer un montant valide";return}if(s.value&&parseFloat(a.value.amount)>s.value.balance){n.value.amount="Le montant du retrait ne peut pas dépasser le solde du compte";return}if(!a.value.payment_method){n.value.payment_method="Veuillez sélectionner un mode de paiement";return}if(!a.value.transaction_date){n.value.transaction_date="Veuillez spécifier une date de transaction";return}m.value=!0;try{const o=await p.dispatch("savings/withdrawFromAccount",{accountId:c,withdrawData:a.value});o.success?(d.success("Retrait effectué avec succès"),h.push(`/savings/${c}`)):o.errors?n.value=o.errors:d.error("Erreur lors du retrait")}catch(o){console.error("Erreur lors du retrait:",o),d.error("Une erreur est survenue lors du retrait")}finally{m.value=!1}},k=o=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XOF",minimumFractionDigits:0}).format(o||0),B=g(()=>{var t;if(n.value.amount)return!1;const o=parseFloat(a.value.amount);return!(isNaN(o)||o<=0||o>parseFloat(((t=s.value)==null?void 0:t.balance)||0)||a.value.payment_method!=="cash"&&!a.value.reference_number)}),C=o=>{switch(o){case"active":return"Actif";case"inactive":return"Inactif";case"closed":return"Clôturé";default:return o}};return(o,t)=>{const V=$("router-link");return u(),i("div",null,[e("div",H,[F(V,{to:`/savings/${S(c)}`,class:"text-gray-500 hover:text-gray-700 mr-2"},{default:M(()=>t[3]||(t[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])),_:1},8,["to"]),t[4]||(t[4]=e("h1",{class:"text-sm font-medium tracking-widest text-gray-600 ml-2"},"Retrait sur compte d'épargne",-1))]),b.value?(u(),i("div",O,t[5]||(t[5]=[e("svg",{class:"animate-spin h-5 w-5 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("p",null,"Chargement des informations du compte...",-1)]))):l.value?(u(),i("div",W,[e("div",P,[t[6]||(t[6]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("p",X,r(l.value),1)])])):s.value?(u(),i("div",G,[e("div",J,[e("div",K,[t[11]||(t[11]=e("div",{class:"p-4 bg-blue-50 border-b border-gray-200"},[e("h3",{class:"text-xs font-semibold text-blue-700"},"Informations du compte")],-1)),e("div",Q,[e("div",Y,[t[7]||(t[7]=e("span",{class:"text-xs text-gray-500"},"N° Compte:",-1)),e("span",Z,r(s.value.account_number),1),t[8]||(t[8]=e("span",{class:"text-xs text-gray-500"},"Client:",-1)),e("span",ee,r(s.value.client?`${s.value.client.first_name} ${s.value.client.last_name}`:"N/A"),1),t[9]||(t[9]=e("span",{class:"text-xs text-gray-500"},"Solde actuel:",-1)),e("span",te,r(k(s.value.balance)),1),t[10]||(t[10]=e("span",{class:"text-xs text-gray-500"},"Statut:",-1)),e("span",{class:A(["px-2 w-[70px] inline-flex text-xs leading-5 font-semibold rounded-lg",{"bg-green-100 text-green-800":s.value.status==="active","bg-yellow-100 text-yellow-800":s.value.status==="inactive","bg-red-100 text-red-800":s.value.status==="closed"}])},r(C(s.value.status)),3)])])]),e("div",se,[t[16]||(t[16]=e("div",{class:"p-4 bg-primary bg-opacity-5 border-b border-gray-200"},[e("h3",{class:"text-xs font-semibold text-primary"},"Informations du client associé")],-1)),e("div",ae,[e("div",oe,[t[12]||(t[12]=e("span",{class:"text-xs text-gray-500"},"Nom :",-1)),e("span",re,r(s.value.client.first_name),1),t[13]||(t[13]=e("span",{class:"text-xs text-gray-500"},"Prénom :",-1)),e("span",ne,r(s.value.client.last_name),1),t[14]||(t[14]=e("span",{class:"text-xs text-gray-500"},"Téléphone :",-1)),e("span",le,r(s.value.client.phone_number),1),t[15]||(t[15]=e("span",{class:"text-xs text-gray-500"},"Statut:",-1)),e("span",{class:A(["px-2 w-[70px] inline-flex text-xs leading-5 font-semibold rounded-lg",{"bg-green-100 text-green-800":s.value.client.status==="active","bg-yellow-100 text-yellow-800":s.value.client.status==="inactive","bg-red-100 text-red-800":s.value.client.status==="closed"}])},r(C(s.value.status)),3)])])])]),e("div",ie,[e("div",ue,[t[25]||(t[25]=e("div",{class:"p-4 bg-primary bg-opacity-10 border-b border-gray-200"},[e("h3",{class:"text-xs font-semibold text-primary"},"Effectuer un retrait")],-1)),e("div",de,[e("form",{onSubmit:q(E,["prevent"])},[e("div",ce,[t[18]||(t[18]=e("label",{for:"amount",class:"block text-xs font-medium text-gray-700 mb-1"},[f("Montant du retrait "),e("span",{class:"text-red-500"},"*")],-1)),e("div",me,[t[17]||(t[17]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 text-xs sm:text-xs"},"FCFA")],-1)),w(e("input",{type:"number",id:"amount","onUpdate:modelValue":t[0]||(t[0]=v=>a.value.amount=v),min:"0.01",max:s.value.balance,step:"0.01",required:"",placeholder:"0.00",class:"pl-16 block w-full focus:outline-none focus:ring-primary focus:border-primary text-xs rounded-md h-[34px] px-3 border border-gray-300",disabled:m.value},null,8,pe),[[N,a.value.amount]])]),n.value.amount?(u(),i("p",ve,r(n.value.amount),1)):a.value.amount>0&&a.value.amount<=s.value.balance?(u(),i("p",xe," Nouveau solde après retrait: "+r(k(parseFloat(s.value.balance)-parseFloat(a.value.amount))),1)):y("",!0)]),e("div",ge,[t[20]||(t[20]=e("label",{for:"payment_method",class:"block text-sm font-medium text-gray-700 mb-1"},[f("Mode de paiement "),e("span",{class:"text-red-500"},"*")],-1)),w(e("select",{id:"payment_method","onUpdate:modelValue":t[1]||(t[1]=v=>a.value.payment_method=v),required:"",disabled:"",class:"block w-full text-xs rounded-md border-gray-300 h-[34px] px-3"},t[19]||(t[19]=[e("option",{value:"cash"},"Espèces",-1),e("option",{value:"mobile_money"},"Mobile Money",-1),e("option",{value:"transfer"},"Virement bancaire",-1),e("option",{value:"check"},"Chèque",-1)]),8,fe),[[U,a.value.payment_method]])]),e("div",be,[t[21]||(t[21]=e("label",{for:"description",class:"block text-xs font-medium text-gray-700 mb-1"},"Description",-1)),w(e("textarea",{id:"description","onUpdate:modelValue":t[2]||(t[2]=v=>a.value.description=v),rows:"1",disabled:"",placeholder:"Description du retrait (optionnel)",class:"block text-xs text-gray-800 w-full rounded-md p-3 border-gray-300 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-20"},null,8,ye),[[N,a.value.description]])]),e("div",we,[F(V,{to:`/savings/${S(c)}`,class:"btn btn-success mr-2",disabled:m.value},{default:M(()=>t[22]||(t[22]=[f(" Annuler ")])),_:1},8,["to","disabled"]),e("button",{type:"submit",class:"btn btn-primary",disabled:m.value||!B.value},[e("div",_e,[m.value?(u(),i("svg",ke,t[23]||(t[23]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):y("",!0),t[24]||(t[24]=f(" Valider le retrait "))])],8,he)])],32)])])])])):y("",!0)])}}};export{Me as default};
