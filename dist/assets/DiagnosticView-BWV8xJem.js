import{r as m,c as o,m as i,b as a,x,n as b,t as c,F as _,l as k,q as S,G as p,H as g,k as B,d as $,w as L,g as z}from"./index-CHW42hPp.js";const P={class:"bg-white shadow-sm rounded-lg p-4 border border-gray-200"},N={class:"flex space-x-2 mb-3"},M=["disabled"],V={key:0,class:"inline-block animate-spin mr-1"},q={class:"mt-3 p-3 bg-primary bg-opacity-5 rounded-md border border-primary border-opacity-20"},O={class:"flex gap-2 mb-2"},U=["disabled"],G={key:0,class:"inline-block animate-spin mr-1"},H={key:0,class:"bg-white p-2 rounded-md border border-gray-200 mt-2"},J={class:"text-xs bg-gray-50 p-2 overflow-auto rounded-md max-h-32"},F={class:"mt-3 bg-gray-50 p-3 rounded-md border border-gray-200"},K={class:"text-xs font-medium text-gray-700 flex items-center justify-between mb-2"},Q={class:"text-xs text-gray-500"},W={key:0,class:"text-gray-500 italic text-xs"},X={key:1,class:"h-64 overflow-auto"},Y={class:"font-medium"},Z={class:"text-xs overflow-x-auto whitespace-pre-wrap"},ee={class:"mt-3 p-3 bg-gray-50 rounded-md border border-gray-200"},te=["disabled"],se={key:0,class:"inline-block animate-spin mr-1"},ae={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-3"},re={class:"bg-white p-2 rounded-md border border-gray-200"},ne={class:"text-xs bg-gray-50 p-2 overflow-auto rounded-md max-h-32"},oe={class:"bg-white p-2 rounded-md border border-gray-200"},ie={key:0,class:"text-xs text-gray-500 italic"},le={key:1,class:"overflow-auto max-h-32"},de={__name:"DiagnosticTool",setup(C){const y=m([]),l=m(!1),f=m(!1),h=m(null),w=m(!1),u=m(null),d=m([]),t=(e,s,r="info")=>{y.value.push({title:e,content:typeof s=="object"?JSON.stringify(s,null,2):s,type:r,timestamp:new Date().toISOString()})},I=async()=>{l.value=!0;try{t("Test API","Démarrage du test de récupération des clients...");const e=localStorage.getItem("token");if(!e){t("Erreur","Aucun token trouvé! L'utilisateur n'est pas connecté.","error");return}t("Token",`Token trouvé: ${e.substring(0,10)}...`),t("Requête 1","Requête GET /clients sans paramètres");const s=await p.get(`${g}/clients`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});t("Réponse 1",s.data,s.status===200?"success":"warning"),t("Requête 2","Requête GET /clients avec cache-buster");const r=await p.get(`${g}/clients`,{params:{_t:Date.now()},headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});t("Réponse 2",r.data,r.status===200?"success":"warning"),E(r.data)}catch(e){t("Erreur",`Erreur lors du test: ${e.message}`,"error"),e.response&&t("Détails erreur",e.response.data,"error")}finally{l.value=!1}},E=e=>{if(!e){t("Analyse","Réponse vide!","error");return}t("Analyse","Analyse de la structure de la réponse:"),"status"in e?t("Analyse",`Status: ${e.status}`,e.status==="success"?"success":"error"):t("Analyse",'Pas de champ "status" dans la réponse',"warning"),"data"in e?Array.isArray(e.data)?t("Analyse",`data est un tableau avec ${e.data.length} éléments`,"info"):typeof e.data=="object"?(t("Analyse","data est un objet","info"),"current_page"in e.data?(t("Analyse","Structure de pagination détectée","success"),t("Pagination",{current_page:e.data.current_page,total:e.data.total,per_page:e.data.per_page,from:e.data.from,to:e.data.to}),Array.isArray(e.data.data)?(t("Analyse",`L'objet pagination contient ${e.data.data.length} clients`,"success"),e.data.data.length>0?t("Premier client",e.data.data[0]):t("Analyse","Le tableau de clients est vide!","warning")):t("Analyse","Pas de tableau data dans l'objet pagination","error")):(t("Analyse","Structure inconnue pour data","warning"),Object.keys(e.data).forEach(s=>{t("Propriété",`${s}: ${typeof e.data[s]}`)}))):t("Analyse",`data est de type ${typeof e.data}`,"warning"):t("Analyse",'Pas de champ "data" dans la réponse',"error")},j=()=>{y.value=[],t("Système","Logs effacés")},R=e=>{switch(e){case"success":return"bg-green-50 border-l-2 border-green-500";case"error":return"bg-red-50 border-l-2 border-red-500";case"warning":return"bg-yellow-50 border-l-2 border-yellow-500";default:return"bg-primary-50 border-l-2 border-primary-500"}},T=async()=>{f.value=!0;try{const e=localStorage.getItem("token");if(!e){t("Erreur","Aucun token trouvé! L'utilisateur n'est pas connecté.","error");return}if(!u.value){t("Utilisateur","Chargement des informations utilisateur...","info");const n=await p.get(`${g}/auth/user`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});n.data&&n.data.status==="success"&&(u.value=n.data.data)}let s=1;if(u.value)if(u.value.role==="agent")s=u.value.id,t("Agent",`Utilisation de l'ID d'agent de l'utilisateur connecté: ${s}`,"info");else{if(d.value.length===0)try{const n=await p.get(`${g}/users?role=agent`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});n.data&&n.data.status==="success"&&(Array.isArray(n.data.data)?d.value=n.data.data:n.data.data&&Array.isArray(n.data.data.data)&&(d.value=n.data.data.data))}catch{t("Erreur agents","Impossible de charger la liste des agents","warning")}d.value.length>0?(s=d.value[0].id,t("Agent",`Utilisation du premier agent disponible: ${s}`,"info")):t("Agent",`Aucun agent disponible, utilisation de l'ID par défaut: ${s}`,"warning")}const r=Math.floor(Math.random()*1e4),v={first_name:`Test${r}`,last_name:`Client${r}`,id_card_number:`ID-TEST-${r}`,profession:"Testeur",address:"123 Rue de Test",phone_number:`+243 ${Math.floor(Math.random()*9e8)+1e8}`,email:`test${r}@example.com`,agent_id:s,status:"active"};t("Création client","Tentative de création du client test avec données:","info"),t("Données client",v);const A=await p.post(`${g}/clients`,v,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json","Content-Type":"application/json"}});t("Réponse création",A.data,A.status===201?"success":"warning"),h.value=A.data.data,setTimeout(async()=>{try{const n=await p.get(`${g}/clients`,{params:{_t:Date.now(),search:v.first_name},headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});t("Vérification","Recherche du client nouvellement créé:","info"),t("Résultat recherche",n.data,"success")}catch(n){t("Erreur vérification",`Impossible de vérifier si le client a été créé: ${n.message}`,"error")}},1e3)}catch(e){t("Erreur création",`Erreur lors de la création du client: ${e.message}`,"error"),e.response&&t("Détails erreur",e.response.data,"error")}finally{f.value=!1}},D=async()=>{w.value=!0;try{const e=localStorage.getItem("token");if(!e){t("Erreur","Aucun token trouvé! L'utilisateur n'est pas connecté.","error");return}const s=await p.get(`${g}/auth/user`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});s.data&&s.data.status==="success"&&(u.value=s.data.data,t("Utilisateur","Informations utilisateur chargées","success"));try{const r=await p.get(`${g}/users?role=agent`,{headers:{Authorization:`Bearer ${e}`,Accept:"application/json"}});r.data&&r.data.status==="success"&&(Array.isArray(r.data.data)?d.value=r.data.data:r.data.data&&Array.isArray(r.data.data.data)&&(d.value=r.data.data.data),t("Agents",`${d.value.length} agents chargés`,"success"))}catch{t("Erreur agents","Impossible de charger la liste des agents","warning")}}catch(e){t("Erreur utilisateur",`Erreur lors du chargement des informations utilisateur: ${e.message}`,"error"),e.response&&t("Détails erreur",e.response.data,"error")}finally{w.value=!1}};return t("Système","Outil de diagnostic chargé"),(e,s)=>(i(),o("div",P,[s[12]||(s[12]=a("h2",{class:"text-sm font-medium text-gray-800 mb-3"},"Outil de diagnostic API",-1)),a("div",N,[a("button",{onClick:I,class:"bg-primary hover:bg-primary-dark text-white py-1.5 px-3 rounded-md text-xs font-medium",disabled:l.value},[l.value?(i(),o("span",V,"⟳")):x("",!0),s[0]||(s[0]=b(" Tester récupération clients "))],8,M),a("button",{onClick:j,class:"bg-gray-200 hover:bg-gray-300 text-gray-700 py-1.5 px-3 rounded-md text-xs font-medium"}," Effacer les logs ")]),a("div",q,[s[3]||(s[3]=a("h3",{class:"text-xs font-medium text-gray-700 mb-2"},"Test de création de client",-1)),a("div",O,[a("button",{onClick:T,class:"bg-secondary hover:bg-secondary-dark text-white py-1.5 px-3 rounded-md text-xs font-medium",disabled:f.value},[f.value?(i(),o("span",G,"⟳")):x("",!0),s[1]||(s[1]=b(" Créer un client test "))],8,U)]),h.value?(i(),o("div",H,[s[2]||(s[2]=a("h4",{class:"text-xs font-medium text-gray-700 mb-1"},"Client créé:",-1)),a("pre",J,c(JSON.stringify(h.value,null,2)),1)])):x("",!0)]),a("div",F,[a("h3",K,[s[4]||(s[4]=a("span",null,"Logs de diagnostic:",-1)),a("span",Q,c(y.value.length)+" entrées",1)]),y.value.length===0?(i(),o("div",W," Aucun log pour le moment ")):(i(),o("div",X,[(i(!0),o(_,null,k(y.value,(r,v)=>(i(),o("div",{key:v,class:S(["mb-1.5 p-1.5 rounded-md text-xs",R(r.type)])},[a("div",Y,c(r.title),1),a("pre",Z,c(r.content),1)],2))),128))]))]),a("div",ee,[s[11]||(s[11]=a("h3",{class:"text-xs font-medium text-gray-700 mb-2"},"Informations utilisateur",-1)),a("button",{onClick:D,class:"bg-primary hover:bg-primary-dark text-white py-1.5 px-3 rounded-md text-xs font-medium mb-2",disabled:l.value},[w.value?(i(),o("span",se,"⟳")):x("",!0),s[5]||(s[5]=b(" Charger les infos utilisateur "))],8,te),u.value?(i(),o("div",ae,[a("div",re,[s[6]||(s[6]=a("h4",{class:"text-xs font-medium text-gray-700 mb-1"},"Utilisateur connecté:",-1)),a("pre",ne,c(JSON.stringify(u.value,null,2)),1)]),a("div",oe,[s[10]||(s[10]=a("h4",{class:"text-xs font-medium text-gray-700 mb-1"},"Agents disponibles:",-1)),d.value.length===0?(i(),o("div",ie," Aucun agent disponible ")):(i(),o("div",le,[(i(!0),o(_,null,k(d.value,r=>(i(),o("div",{key:r.id,class:"mb-1 p-1.5 bg-gray-50 rounded-md text-xs"},[a("div",null,[s[7]||(s[7]=a("span",{class:"font-medium"},"ID:",-1)),b(" "+c(r.id),1)]),a("div",null,[s[8]||(s[8]=a("span",{class:"font-medium"},"Nom:",-1)),b(" "+c(r.name),1)]),a("div",null,[s[9]||(s[9]=a("span",{class:"font-medium"},"Email:",-1)),b(" "+c(r.email),1)])]))),128))]))])])):x("",!0)])]))}},ue={class:"flex justify-between items-center mb-4"},ce={class:"flex items-center"},ge={__name:"DiagnosticView",setup(C){return(y,l)=>{const f=z("router-link");return i(),o("div",null,[a("div",ue,[a("div",ce,[$(f,{to:"/",class:"text-primary hover:text-primary-dark flex items-center mr-3"},{default:L(()=>l[0]||(l[0]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z","clip-rule":"evenodd"})],-1),a("span",{class:"text-xs"},"Retour au tableau de bord",-1)])),_:1}),l[1]||(l[1]=a("h1",{class:"text-sm font-medium text-gray-800"},"Diagnostic système",-1))])]),l[2]||(l[2]=B('<div class="bg-white shadow-sm rounded-lg p-4 border border-gray-200 mb-4"><p class="text-xs text-gray-600 mb-3">Cet outil permet de tester les connexions API et de diagnostiquer d&#39;éventuels problèmes techniques.</p><div class="flex flex-wrap gap-2"><div class="bg-primary bg-opacity-10 text-primary px-2 py-1 rounded-md text-xs border border-primary border-opacity-20 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Version API: 1.0 </div><div class="bg-green-100 text-green-800 px-2 py-1 rounded-md text-xs border border-green-200 flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg> Connexion: Active </div></div></div>',1)),$(de)])}}};export{ge as default};
