import{r as i,B as j,R as q,o as P,a as O,O as G,c as v,b as e,x as _,d as k,w as A,g as H,t as u,v as J,n as d,y as x,z as b,F as K,l as Q,D as W,M as X,m as p}from"./index-CHW42hPp.js";import{u as Y}from"./toast-DZktrDzS.js";const Z={class:"flex items-center mb-6"},ee={key:0,class:"bg-red-50 border-l-4 border-red-500 p-4 mb-6 rounded-md"},te={class:"flex"},se={class:"text-sm text-red-700"},re={class:"bg-white shadow rounded-lg overflow-hidden"},le={class:"p-6"},oe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ne={class:"col-span-2"},ae={class:"relative"},ie={key:0,class:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg"},ue={class:"max-h-60 overflow-auto"},de=["onClick"],ce={class:"flex items-center"},me={class:"h-8 w-8 rounded-full bg-secondary text-white flex items-center justify-center text-sm font-medium"},ve={class:"ml-3"},pe={class:"text-sm font-medium text-gray-900"},fe={class:"text-xs text-gray-500"},ge={key:1,class:"absolute z-10 mt-1 w-full bg-white border border-gray-300 rounded-md shadow-lg"},xe={class:"px-4 py-2 text-sm text-gray-500"},be={key:0,class:"mt-3 p-3 bg-gray-50 rounded-md"},he={class:"flex items-center"},ye={class:"h-10 w-10 rounded-full bg-secondary text-white flex items-center justify-center text-sm font-medium"},we={class:"ml-3 flex-grow"},_e={class:"text-sm font-medium text-gray-900"},Ce={class:"text-xs text-gray-500"},ke={class:"mt-1 relative rounded-md shadow-sm"},Ae={class:"mt-1 relative rounded-md shadow-sm"},Le={class:"mt-8 flex justify-end"},Ve=["disabled"],Ue={class:"flex items-center"},Me={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Ie={__name:"SavingsCreateView",setup(Se){const z=X(),L=q(),h=Y(),V=i([]),C=i(!1),l=i({client_id:"",balance:0,interest_rate:3.5,status:"active",opening_date:new Date().toISOString().split("T")[0],account_number:""}),U=j(()=>L.getters["savings/isLoading"]),y=i({}),n=i(""),w=i(!1),m=i(""),f=i([]),c=i([]),g=i(!1),a=i(null);P(async()=>{await M(),document.addEventListener("click",S)});const M=async()=>{C.value=!0;try{const s=await O.getClients({per_page:100});console.log("Réponse API clients:",s.data),s.data.status==="success"?(V.value=s.data.data,f.value=s.data.data,console.log("Clients chargés:",V.value.length)):(n.value="Format de réponse API inattendu",console.error("Format de réponse API inattendu:",s.data))}catch(s){console.error("Erreur lors du chargement des clients:",s),h.error("Impossible de charger la liste des clients"),n.value="Impossible de charger la liste des clients"}finally{C.value=!1}},I=()=>{var t;if(console.log("Recherche de clients avec:",m.value),console.log("État de allClients:",{length:(t=f.value)==null?void 0:t.length,isDefined:!!f.value}),!f.value||f.value.length===0){console.log("Aucun client chargé, tentative de chargement..."),C.value||M(),c.value=[];return}if(m.value.trim()===""){console.log("Recherche vide, aucun résultat affiché"),c.value=[];return}const s=m.value.toLowerCase();console.log("Terme de recherche:",s);try{c.value=f.value.filter(o=>{const r=o.first_name||"",N=o.last_name||"",$=`${r} ${N}`.toLowerCase(),F=(o.phone_number||"").toLowerCase(),R=(o.email||"").toLowerCase(),T=(o.id_card_number||"").toLowerCase();return $.includes(s)||F.includes(s)||R.includes(s)||T.includes(s)}),console.log(`Résultats de recherche: ${c.value.length} clients trouvés`),c.value.length===0&&console.log("Aucun client ne correspond à la recherche")}catch(o){console.error("Erreur lors du filtrage des clients:",o),n.value="Erreur lors de la recherche de clients",c.value=[]}},B=s=>{if(console.log("Client sélectionné:",s),!s||!s.id){console.error("Client invalide sélectionné:",s),n.value="Client invalide sélectionné";return}a.value=s,l.value.client_id=s.id,console.log("ID client défini dans le formulaire:",l.value.client_id);const t=s.first_name||"",o=s.last_name||"";m.value=`${t} ${o}`.trim(),g.value=!1},D=()=>{a.value=null,l.value.client_id="",m.value=""},S=s=>{g.value&&!s.target.closest("#client-search")&&(g.value=!1)},E=async()=>{if(w.value=!0,y.value={},n.value="",!a.value){y.value.client_id="Veuillez sélectionner un client",n.value="Veuillez sélectionner un client",w.value=!1;return}if(l.value.balance<0){y.value.balance="Le solde initial ne peut pas être négatif",n.value="Le solde initial ne peut pas être négatif",w.value=!1;return}try{const s=await L.dispatch("savings/createAccount",l.value);s.success?(h.success("Compte d'épargne créé avec succès"),z.push(`/savings/${s.data.id}`)):s.errors?(y.value=s.errors,n.value="Veuillez corriger les erreurs dans le formulaire."):(n.value="Erreur lors de la création du compte d'épargne",h.error("Erreur lors de la création du compte d'épargne"))}catch(s){console.error("Erreur lors de la création du compte:",s),n.value="Une erreur est survenue lors de la création du compte d'épargne",h.error("Une erreur est survenue lors de la création du compte d'épargne")}finally{w.value=!1}};return G(()=>{document.removeEventListener("click",S)}),(s,t)=>{const o=H("router-link");return p(),v("div",null,[e("div",Z,[k(o,{to:"/savings",class:"text-gray-500 hover:text-gray-700 mr-2"},{default:A(()=>t[7]||(t[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])),_:1}),t[8]||(t[8]=e("h1",{class:"text-sm font-medium text-gray-700 ml-2"},"Nouveau compte",-1))]),n.value?(p(),v("div",ee,[e("div",te,[t[9]||(t[9]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-red-500 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("p",se,u(n.value),1)])])):_("",!0),e("div",re,[t[26]||(t[26]=e("div",{class:"p-4 bg-primary bg-opacity-10 border-b border-gray-200"},[e("h3",{class:"text-sm font-medium text-primary"},"Informations du compte")],-1)),e("div",le,[e("form",{onSubmit:J(E,["prevent"])},[e("div",oe,[e("div",ne,[t[13]||(t[13]=e("label",{for:"client",class:"block text-xs font-medium text-gray-700 mb-1"},[d("Client "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ae,[x(e("input",{type:"text",id:"client-search","onUpdate:modelValue":t[0]||(t[0]=r=>m.value=r),onInput:I,onFocus:t[1]||(t[1]=r=>g.value=!0),placeholder:"Rechercher un client par nom...",class:"block w-full text-xs focus:ring-primary focus:border-primary focus:outline-none rounded-md h-[34px] px-3 border border-gray-300"},null,544),[[b,m.value]]),g.value&&c.value.length>0?(p(),v("div",ie,[e("ul",ue,[(p(!0),v(K,null,Q(c.value,r=>(p(),v("li",{key:r.id,onClick:N=>B(r),class:"px-4 py-2 cursor-pointer hover:bg-gray-100"},[e("div",ce,[e("div",me,u(r.first_name.charAt(0).toUpperCase()+r.last_name.charAt(0).toUpperCase()),1),e("div",ve,[e("div",pe,u(r.first_name)+" "+u(r.last_name),1),e("div",fe,u(r.id_card_number)+" • "+u(r.phone_number||"Pas de téléphone"),1)])])],8,de))),128))])])):g.value&&m.value&&c.value.length===0?(p(),v("div",ge,[e("div",xe,[t[11]||(t[11]=d(" Aucun client trouvé. ")),k(o,{to:"/clients/new",class:"text-primary hover:underline"},{default:A(()=>t[10]||(t[10]=[d("Créer un nouveau client")])),_:1})])])):_("",!0)]),a.value?(p(),v("div",be,[e("div",he,[e("div",ye,u(a.value.first_name.charAt(0).toUpperCase()+a.value.last_name.charAt(0).toUpperCase()),1),e("div",we,[e("div",_e,u(a.value.first_name)+" "+u(a.value.last_name),1),e("div",Ce,u(a.value.id_card_number)+" • "+u(a.value.phone_number||"Pas de téléphone"),1)]),e("button",{type:"button",onClick:D,class:"text-gray-400 hover:text-gray-500"},t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))])])):_("",!0)]),e("div",null,[t[15]||(t[15]=e("label",{for:"balance",class:"block text-xs font-medium text-gray-700 mb-1"},[d("Montant initial "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ke,[t[14]||(t[14]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 text-xs sm:text-xs"},"FCFA")],-1)),x(e("input",{type:"number",id:"balance","onUpdate:modelValue":t[2]||(t[2]=r=>l.value.balance=r),min:"0",required:"",placeholder:"0",class:"pl-16 text-xs block focus:ring-primary focus:border-primary focus:outline-none w-full rounded-md h-[34px] px-3 border border-gray-300"},null,512),[[b,l.value.balance]])])]),e("div",null,[t[17]||(t[17]=e("label",{for:"interest_rate",class:"block text-xs font-medium text-gray-700 mb-1"},[d("Taux d'intérêt (%) "),e("span",{class:"text-red-500"},"*")],-1)),e("div",Ae,[x(e("input",{type:"number",id:"interest_rate","onUpdate:modelValue":t[3]||(t[3]=r=>l.value.interest_rate=r),min:"0",max:"100",step:"0.01",required:"",placeholder:"0.00",class:"pr-8 block w-full focus:ring-primary focus:border-primary text-xs rounded-md h-[34px] px-3 border focus:outline-none border-gray-300"},null,512),[[b,l.value.interest_rate]]),t[16]||(t[16]=e("div",{class:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none"},[e("span",{class:"text-gray-500 text-xs sm:text-xs"},"%")],-1))])]),e("div",null,[t[18]||(t[18]=e("label",{for:"account_number",class:"block text-xs font-medium text-gray-700 mb-1"},[d("Numéro de compte "),e("span",{class:"text-gray-400 font-normal"},"(Optionnel)")],-1)),x(e("input",{type:"text",id:"account_number",disabled:"","onUpdate:modelValue":t[4]||(t[4]=r=>l.value.account_number=r),placeholder:"Généré automatiquement si vide",class:"block w-full focus:ring-primary focus:border-primary rounded-md h-[34px] px-3 border focus:outline-none text-xs border-gray-300"},null,512),[[b,l.value.account_number]]),t[19]||(t[19]=e("p",{class:"text-xs text-gray-500 mt-1"},"Laissez vide pour une génération automatique.",-1))]),e("div",null,[t[20]||(t[20]=e("label",{for:"opening_date",class:"block text-xs font-medium text-gray-700 mb-1"},[d("Date d'ouverture "),e("span",{class:"text-red-500"},"*")],-1)),x(e("input",{type:"date",id:"opening_date","onUpdate:modelValue":t[5]||(t[5]=r=>l.value.opening_date=r),required:"",class:"block w-full focus:ring-primary focus:border-primary text-xs focus:outline-none rounded-md h-[34px] px-3 border border-gray-300"},null,512),[[b,l.value.opening_date]])]),e("div",null,[t[22]||(t[22]=e("label",{for:"status",class:"block text-xs font-medium text-gray-700 mb-1"},[d("Statut "),e("span",{class:"text-red-500"},"*")],-1)),x(e("select",{id:"status","onUpdate:modelValue":t[6]||(t[6]=r=>l.value.status=r),required:"",disabled:"",class:"block w-full focus:ring-primary focus:border-primary rounded-md text-xs h-[34px] focus:outline-none px-3 border border-gray-300"},t[21]||(t[21]=[e("option",{value:"active"},"Actif",-1),e("option",{value:"inactive"},"Inactif",-1)]),512),[[W,l.value.status]])])]),e("div",Le,[k(o,{to:"/savings",class:"btn btn-secondary mr-2"},{default:A(()=>t[23]||(t[23]=[d(" Annuler ")])),_:1}),e("button",{type:"submit",class:"btn btn-primary",disabled:U.value||!a.value},[e("div",Ue,[U.value?(p(),v("svg",Me,t[24]||(t[24]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):_("",!0),t[25]||(t[25]=d(" Créer le compte "))])],8,Ve)])],32)])])])}}};export{Ie as default};
