import{_ as J,u as K,r as g,J as B,o as Q,K as O,c as d,b as e,x as M,d as L,w as S,g as W,y as A,z as X,D as $,e as Y,t as l,n as x,F as D,l as V,q as _,a as T,L as Z,M as ee,m as u}from"./index-CHW42hPp.js";const te={class:"flex justify-between items-center mb-4"},se={class:"bg-white rounded-lg shadow-sm p-3 mb-4"},re={class:"grid grid-cols-1 md:grid-cols-4 gap-3"},oe={class:"col-span-2"},ae={class:"relative"},ne={key:0,value:"me"},le={key:0,class:"text-center py-10"},ie={key:1,class:"bg-white rounded-lg shadow-sm p-6 my-4"},de={class:"text-gray-600 mb-4"},ue={class:"flex space-x-2"},ce={key:2,class:"bg-white rounded-lg shadow-sm p-4 my-4 text-center"},pe={class:"text-sm text-gray-500 mb-3"},me={key:3,class:"bg-white shadow-sm rounded-lg overflow-hidden"},ge={class:"min-w-full divide-y divide-gray-200"},xe={class:"bg-white divide-y divide-gray-200"},ve=["onClick"],fe={class:"px-4 py-2 whitespace-nowrap"},ye={class:"flex items-center"},he={class:"flex-shrink-0 h-8 w-8 bg-primary bg-opacity-10 rounded-full flex items-center justify-center"},we={class:"text-primary text-sm font-medium"},be={class:"ml-3"},_e={class:"text-xs font-medium text-gray-600"},ke={class:"text-xs text-gray-500"},Ce={class:"px-4 py-2 whitespace-nowrap"},Me={class:"text-xs text-gray-600"},Ae={class:"text-xs text-gray-500"},je={class:"px-4 py-2 whitespace-nowrap"},ze={class:"text-xs text-gray-600"},Be={class:"px-4 py-2 whitespace-nowrap"},Le={class:"text-xs text-gray-600"},Se={class:"px-4 py-2 whitespace-nowrap"},$e={class:"mt-4 flex justify-between items-center border-t border-gray-200 bg-white px-4 py-3"},De={class:"text-xs text-gray-700"},Ve={class:"flex space-x-1"},Te=["disabled"],Pe=["onClick"],Ie={key:1,class:"px-2 py-1 text-xs"},Ne=["disabled"],Ee={key:4,class:"fixed inset-0 z-50 overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true"},Re={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Fe={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"},He={class:"bg-white px-4 pt-4 pb-3"},Ue={class:"sm:flex sm:items-start"},qe={class:"mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"},Ge={class:"mt-2"},Je={class:"text-sm text-gray-500"},Ke={class:"font-medium"},Qe={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"},Oe=["disabled"],We={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Xe={__name:"ClientListView",setup(Ye){const P=K(),I=Z(),N=ee(),v=g([]),k=g(!0),f=g(""),c=B({status:"",agent_id:""}),o=B({current_page:1,from:0,to:0,total:0,last_page:1,per_page:10}),w=g(!1),y=g(null),b=g(!1),h=g(null),j=()=>{o.current_page=1,p()},p=async()=>{k.value=!0,h.value=null;try{const s={page:o.current_page,per_page:o.per_page};f.value.trim()&&(s.search=f.value.trim()),c.status&&(s.status=c.status),c.agent_id&&(s.agent_id=c.agent_id),console.log("Envoi de la requête avec paramètres:",s);const t=await T.getClients(s);if(console.log("Réponse API complète:",t.data),t.data&&t.data.status==="success"){const a=t.data;Array.isArray(a.data)?v.value=a.data:a.data&&Array.isArray(a.data.data)&&(v.value=a.data.data);let n=null;if(a.meta)n=a.meta;else if(a.data&&a.data.meta)n=a.data.meta;else if(a.data&&!Array.isArray(a.data)){const i=a.data;i.current_page!==void 0&&(n={current_page:i.current_page,from:i.from,to:i.to,total:i.total,last_page:i.last_page,per_page:i.per_page})}n?(o.current_page=n.current_page||1,o.from=n.from||0,o.to=n.to||0,o.total=n.total||0,o.last_page=n.last_page||1,o.per_page=n.per_page||10,console.log("Pagination mise à jour:",o)):console.warn("Aucune donnée de pagination trouvée dans la réponse")}else throw new Error("Format de réponse inattendu")}catch(s){console.error("Erreur lors du chargement des clients:",s),h.value="Une erreur est survenue lors du chargement des clients: "+(s.message||""),v.value=[]}finally{k.value=!1}};let z=null;const E=()=>{clearTimeout(z),z=setTimeout(()=>{o.current_page=1,p()},300)},C=s=>{s<1||s>o.last_page||(o.current_page=s,p())},R=()=>{const s=o.last_page,t=o.current_page;if(!s||s<=1)return[1];let a=[];a.push(1);const n=1;let i=Math.max(2,t-n),r=Math.min(s-1,t+n);r-i<n*2&&(t<s/2?r=Math.min(s-1,i+n*2):i=Math.max(2,r-n*2)),i>2&&a.push("...");for(let m=i;m<=r;m++)a.push(m);return r<s-1&&a.push("..."),s>1&&a.push(s),a},F=(s,t)=>(s?s.charAt(0):"")+(t?t.charAt(0):""),H=s=>{const t="px-1.5 py-0.5 inline-flex text-xs leading-4 font-normal rounded-lg";switch(s){case"active":return`${t} bg-green-100 p-2 text-green-800`;case"inactive":return`${t} bg-gray-100 text-gray-800`;case"blacklisted":return`${t} bg-red-100 text-red-800`;default:return`${t} bg-gray-100 text-gray-800`}},U=s=>{switch(s){case"active":return"Actif";case"inactive":return"Inactif";case"blacklisted":return"Liste noire";default:return s}},q=async()=>{if(y.value){b.value=!0;try{const s=await T.deleteClient(y.value.id);s.data&&s.data.status==="success"&&(w.value=!1,y.value=null,p())}catch(s){console.error("Erreur lors de la suppression du client:",s),s.response&&s.response.data&&s.response.data.message?alert(s.response.data.message):alert("Une erreur est survenue lors de la suppression du client.")}finally{b.value=!1}}},G=s=>{N.push({name:"ClientDetail",params:{id:s}})};return Q(()=>{p(),O(()=>I.query.refresh,(s,t)=>{s&&s!==t&&j()})}),(s,t)=>{var n,i;const a=W("router-link");return u(),d("div",null,[e("div",te,[t[10]||(t[10]=e("h1",{class:"text-sm tracking-widest font-medium text-gray-800"},"Liste de clients",-1)),L(a,{to:"/clients/new",class:"btn btn-primary flex items-center"},{default:S(()=>t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1),x(" Nouveau client ")])),_:1})]),e("div",se,[e("div",re,[e("div",oe,[e("div",ae,[t[11]||(t[11]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1)),A(e("input",{type:"text",class:"block w-auto text-xs pl-10 pr-3 py-1.5 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-primary focus:border-primary",placeholder:"Rechercher par nom, email...","onUpdate:modelValue":t[0]||(t[0]=r=>f.value=r),onInput:E},null,544),[[X,f.value]])])]),e("div",null,[A(e("select",{id:"status-filter","onUpdate:modelValue":t[1]||(t[1]=r=>c.status=r),class:"block w-full text-xs text-gray-600 py-1.5 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary",onChange:p},t[12]||(t[12]=[e("option",{value:""},"Tous les statuts",-1),e("option",{value:"active"},"Actif",-1),e("option",{value:"inactive"},"Inactif",-1),e("option",{value:"blacklisted"},"Liste noire",-1)]),544),[[$,c.status]])]),e("div",null,[A(e("select",{id:"agent-filter","onUpdate:modelValue":t[2]||(t[2]=r=>c.agent_id=r),class:"block w-full text-xs py-1.5 px-3 text-gray-600 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary",onChange:p},[t[13]||(t[13]=e("option",{value:""},"Tous les agents",-1)),Y(P).isAdmin?(u(),d("option",ne,"Mes clients")):M("",!0)],544),[[$,c.agent_id]])])])]),k.value?(u(),d("div",le,t[14]||(t[14]=[e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"},null,-1),e("p",{class:"mt-2 text-gray-500"},"Chargement des clients...",-1)]))):h.value?(u(),d("div",ie,[t[17]||(t[17]=e("div",{class:"flex items-center text-red-500 mb-4"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]),e("h2",{class:"text-lg font-medium"},"Erreur de chargement")],-1)),e("p",de,l(h.value),1),e("div",ue,[e("button",{onClick:t[3]||(t[3]=r=>j()),class:"btn btn-primary"},t[15]||(t[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),x(" Réessayer ")])),e("button",{onClick:t[4]||(t[4]=r=>h.value=null),class:"btn btn-secondary"},t[16]||(t[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),x(" Fermer ")]))])])):v.value.length===0?(u(),d("div",ce,[t[19]||(t[19]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-10 w-10 mx-auto text-gray-400 mb-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})],-1)),t[20]||(t[20]=e("h3",{class:"text-md font-medium text-gray-700 mb-1"},"Aucun client trouvé",-1)),e("p",pe,l(f.value||c.status||c.agent_id?"Aucun client ne correspond à vos critères de recherche.":"Commencez par ajouter votre premier client."),1),L(a,{to:"/clients/new",class:"btn btn-primary inline-block text-sm py-1.5 px-3"},{default:S(()=>t[18]||(t[18]=[x(" Nouveauclient ")])),_:1})])):(u(),d("div",me,[e("table",ge,[t[21]||(t[21]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Client "),e("th",{scope:"col",class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Contact "),e("th",{scope:"col",class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Profession "),e("th",{scope:"col",class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Gestionnaire "),e("th",{scope:"col",class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Statut ")])],-1)),e("tbody",xe,[(u(!0),d(D,null,V(v.value,r=>{var m;return u(),d("tr",{key:r.id,class:"hover:bg-gray-50 cursor-pointer",onClick:Ze=>G(r.id)},[e("td",fe,[e("div",ye,[e("div",he,[e("span",we,l(F(r.first_name,r.last_name)),1)]),e("div",be,[e("div",_e,l(r.first_name)+" "+l(r.last_name),1),e("div",ke," ID: "+l(r.id_card_number),1)])])]),e("td",Ce,[e("div",Me,l(r.phone_number),1),e("div",Ae,l(r.email||"Non renseigné"),1)]),e("td",je,[e("div",ze,l(r.profession||"Sans profession"),1)]),e("td",Be,[e("div",Le,l(((m=r.agent)==null?void 0:m.name)||"Non assigné"),1)]),e("td",Se,[e("span",{class:_(H(r.status))},l(U(r.status)),3)])],8,ve)}),128))])]),e("div",$e,[e("div",De," Affichage de "+l(o.from)+" à "+l(o.to)+" sur "+l(o.total)+" résultats ",1),e("div",Ve,[e("button",{onClick:t[5]||(t[5]=r=>C(o.current_page-1)),disabled:o.current_page===1,class:_([o.current_page===1?"opacity-50 cursor-not-allowed":"","px-3 py-1 text-xs border border-gray-300 rounded-md hover:bg-gray-100"])}," Précédent ",10,Te),(u(!0),d(D,null,V(R(),r=>(u(),d("div",{key:r},[r!=="..."?(u(),d("button",{key:0,onClick:m=>C(r),class:_([o.current_page===r?"bg-primary text-white":"bg-white text-gray-700 hover:bg-gray-100","px-3 py-1 text-xs border border-gray-300 rounded-md"])},l(r),11,Pe)):(u(),d("span",Ie,l(r),1))]))),128)),e("button",{onClick:t[6]||(t[6]=r=>C(o.current_page+1)),disabled:o.current_page===o.last_page,class:_([o.current_page===o.last_page?"opacity-50 cursor-not-allowed":"","px-3 py-1 text-xs border border-gray-300 rounded-md hover:bg-gray-100"])}," Suivant ",10,Ne)])])])),w.value?(u(),d("div",Ee,[e("div",Re,[e("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity","aria-hidden":"true",onClick:t[7]||(t[7]=r=>w.value=!1)}),t[28]||(t[28]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Fe,[e("div",He,[e("div",Ue,[t[25]||(t[25]=e("div",{class:"mx-auto flex-shrink-0 flex items-center justify-center h-10 w-10 rounded-full bg-red-100 sm:mx-0 sm:h-8 sm:w-8"},[e("svg",{class:"h-5 w-5 text-red-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),e("div",qe,[t[24]||(t[24]=e("h3",{class:"text-md font-medium text-gray-900",id:"modal-title"}," Supprimer le client ",-1)),e("div",Ge,[e("p",Je,[t[22]||(t[22]=x(" Êtes-vous sûr de vouloir supprimer ")),e("span",Ke,l((n=y.value)==null?void 0:n.first_name)+" "+l((i=y.value)==null?void 0:i.last_name),1),t[23]||(t[23]=x(" ? Cette action est irréversible. "))])])])])]),e("div",Qe,[e("button",{type:"button",class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-3 py-1.5 bg-red-600 text-xs font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto",onClick:q,disabled:b.value},[b.value?(u(),d("svg",We,t[26]||(t[26]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):M("",!0),t[27]||(t[27]=x(" Supprimer "))],8,Oe),e("button",{type:"button",class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-3 py-1.5 bg-white text-xs font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto",onClick:t[8]||(t[8]=r=>w.value=!1)}," Annuler ")])])])])):M("",!0)])}}},tt=J(Xe,[["__scopeId","data-v-212be04a"]]);export{tt as default};
