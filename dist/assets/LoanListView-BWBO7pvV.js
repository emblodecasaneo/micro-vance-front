import{_ as j,c as n,b as e,d as C,w as T,g as H,y as D,D as L,k as q,F as _,l as F,z as G,q as x,x as w,n as p,t as l,N as K,r as d,K as X,o as J,a as z,m as i}from"./index-CHW42hPp.js";const O={name:"LoanListView",setup(){const{showToast:y}=K(),t=d([]),h=d([]),a=d(!1),f=d("all"),k=d(""),u=d(null),r=d({current_page:1,last_page:1,total:0,per_page:10}),m=d({status:"",client_id:"",start_date_from:"",start_date_to:"",search:""}),b=d("created_at"),v=d("desc"),c=async()=>{a.value=!0;try{let s="/loans",o={page:r.value.current_page,per_page:r.value.per_page,sort_field:b.value,sort_direction:v.value,...m.value};f.value==="overdue"&&(s="/loans/overdue");const g=await z.getLoans(o);t.value=g.data.data.data,r.value={current_page:g.data.data.current_page,last_page:g.data.data.last_page,total:g.data.data.total,per_page:g.data.data.per_page}}catch(s){console.error("Erreur lors du chargement des prêts:",s),y("Erreur lors du chargement des prêts.","error")}finally{a.value=!1}},V=async()=>{try{const s=await z.getClients({per_page:100});h.value=s.data.data.data}catch(s){console.error("Erreur lors du chargement des clients:",s)}},A=s=>{b.value===s?v.value=v.value==="asc"?"desc":"asc":(b.value=s,v.value="asc"),r.value.current_page=1,c()},P=()=>{r.value.current_page=1,c()},S=s=>{s<1||s>r.value.last_page||(r.value.current_page=s,c())},M=async s=>{try{a.value=!0,await z.approveLoan(s),y("Prêt approuvé avec succès.","success"),c()}catch(o){console.error("Erreur lors de l'approbation du prêt:",o),y("Erreur lors de l'approbation du prêt.","error")}finally{a.value=!1}},N=s=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:"XAF"}).format(s),B=s=>{if(!s)return"N/A";const o=new Date(s);return new Intl.DateTimeFormat("fr-FR").format(o)},E=s=>({pending:"bg-yellow-100 text-yellow-800",active:"bg-green-100 text-green-800",completed:"bg-blue-100 text-blue-800",defaulted:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",R=s=>({pending:"En attente",active:"Actif",completed:"Complété",defaulted:"Défaillant"})[s]||s;X(f,()=>{r.value.current_page=1,c()});const I=()=>{const s=r.value.current_page,o=r.value.last_page;return o<=5?Array.from({length:o},(g,U)=>U+1):s<=3?[1,2,3,4,"...",o]:s>=o-2?[1,"...",o-3,o-2,o-1,o]:[1,"...",s-1,s,s+1,"...",o]},Q=()=>{u.value&&clearTimeout(u.value),u.value=setTimeout(()=>{m.value.search=k.value,r.value.current_page=1,c()},300)};return J(()=>{c(),V()}),{loans:t,clients:h,loading:a,pagination:r,filters:m,sortField:b,sortDirection:v,activeTab:f,searchQuery:k,loadLoans:c,sortBy:A,applyFilters:P,changePage:S,approveLoan:M,formatCurrency:N,formatDate:B,getStatusClass:E,getStatusLabel:R,getPaginationRange:I,debouncedSearch:Q}}},W={class:"flex justify-between items-center mb-4"},Y={class:"flex space-x-2"},Z={class:"bg-white rounded-lg shadow-sm p-3 mb-4"},$={class:"grid grid-cols-1 md:grid-cols-3 gap-3"},tt=["value"],et={class:"col-span-1 md:col-span-1"},at={class:"relative"},rt={class:"flex border-b border-gray-200 mb-4"},st={class:"bg-white shadow-sm rounded-lg overflow-hidden border border-gray-200"},ot={key:0,class:"p-4 text-center text-gray-500"},nt={key:1,class:"p-4 text-center text-gray-500"},it={key:2,class:"overflow-x-auto"},lt={class:"min-w-full divide-y divide-gray-200"},dt={class:"bg-gray-50"},ct={key:0},pt={class:"bg-white divide-y divide-gray-200"},ut={class:"py-3 px-4 whitespace-nowrap"},gt={class:"text-xs font-medium text-gray-600"},xt={class:"py-3 px-4 whitespace-nowrap"},mt={class:"text-xs font-medium text-gray-600"},vt={class:"py-3 px-4 whitespace-nowrap"},yt={class:"text-xs font-medium text-gray-600"},ft={class:"py-3 px-4 whitespace-nowrap"},bt={class:"text-xs font-medium text-gray-600"},_t={class:"py-3 px-4 whitespace-nowrap"},wt={class:"text-xs font-medium text-gray-600"},ht={class:"py-3 px-4 whitespace-nowrap"},kt={class:"py-3 px-4 whitespace-nowrap text-xs"},Ct={class:"flex space-x-2"},Tt=["onClick"],Dt={key:0,class:"bg-white px-4 py-3 border-t border-gray-200 sm:px-6"},Ft={class:"flex flex-col sm:flex-row justify-between items-center"},zt={class:"mb-2 sm:mb-0"},Lt={class:"text-xs text-gray-700"},Vt={class:"font-medium"},At={class:"font-medium"},Pt={class:"font-medium"},St={key:0,class:"flex items-center"},Mt=["disabled"],Nt=["onClick"],Bt={key:1,class:"relative inline-flex items-center px-3 py-1 text-xs text-gray-600 ring-1 ring-inset ring-gray-300"},Et=["disabled"];function Rt(y,t,h,a,f,k){const u=H("router-link");return i(),n("div",null,[e("div",W,[t[13]||(t[13]=e("h1",{class:"text-sm tracking-widest ml-1 font-medium text-gray-800"},"Gestion des prêts",-1)),e("div",Y,[C(u,{to:"/loans/overdue",class:"btn btn-secondary flex items-center"},{default:T(()=>t[11]||(t[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z","clip-rule":"evenodd"})],-1),p(" Remboursements en retard ")])),_:1}),C(u,{to:"/loans/new",class:"btn btn-primary flex items-center"},{default:T(()=>t[12]||(t[12]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-2",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1),p(" Nouveau prêt ")])),_:1})])]),e("div",Z,[e("div",$,[e("div",null,[D(e("select",{"onUpdate:modelValue":t[0]||(t[0]=r=>a.filters.status=r),class:"block w-full text-xs text-gray-600 py-1.5 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary",onChange:t[1]||(t[1]=(...r)=>a.applyFilters&&a.applyFilters(...r))},t[14]||(t[14]=[q('<option value="" data-v-b69a9348>Tous les statuts</option><option value="pending" data-v-b69a9348>En attente</option><option value="active" data-v-b69a9348>Actif</option><option value="completed" data-v-b69a9348>Complété</option><option value="defaulted" data-v-b69a9348>Défaillant</option>',5)]),544),[[L,a.filters.status]])]),e("div",null,[D(e("select",{"onUpdate:modelValue":t[2]||(t[2]=r=>a.filters.client_id=r),class:"block w-full text-xs text-gray-600 py-1.5 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary",onChange:t[3]||(t[3]=(...r)=>a.applyFilters&&a.applyFilters(...r))},[t[15]||(t[15]=e("option",{value:""},"Tous les clients",-1)),(i(!0),n(_,null,F(a.clients,r=>(i(),n("option",{key:r.id,value:r.id},l(r.last_name)+" "+l(r.first_name),9,tt))),128))],544),[[L,a.filters.client_id]])]),e("div",et,[e("div",at,[t[16]||(t[16]=e("div",{class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},[e("svg",{class:"h-4 w-4 text-gray-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1)),D(e("input",{type:"text",class:"block w-full text-xs pl-10 pr-3 py-1.5 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:ring-primary focus:border-primary",placeholder:"Rechercher","onUpdate:modelValue":t[4]||(t[4]=r=>a.searchQuery=r),onInput:t[5]||(t[5]=(...r)=>a.debouncedSearch&&a.debouncedSearch(...r))},null,544),[[G,a.searchQuery]])])])])]),e("div",rt,[e("button",{onClick:t[6]||(t[6]=r=>a.activeTab="all"),class:x(["px-3 py-1.5 text-xs font-medium",a.activeTab==="all"?"border-b-2 border-primary text-primary":"text-gray-500 hover:text-gray-700"])}," Tous les prêts ",2),e("button",{onClick:t[7]||(t[7]=r=>a.activeTab="overdue"),class:x(["px-3 py-1.5 text-xs font-medium",a.activeTab==="overdue"?"border-b-2 border-primary text-primary":"text-gray-500 hover:text-gray-700"])}," Prêts en retard ",2)]),e("div",st,[a.loading?(i(),n("div",ot,t[17]||(t[17]=[e("svg",{class:"animate-spin h-5 w-5 mx-auto mb-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),e("p",{class:"text-xs"},"Chargement des prêts...",-1)]))):a.loans.length===0?(i(),n("div",nt,t[18]||(t[18]=[e("p",{class:"text-xs"},"Aucun prêt trouvé.",-1)]))):(i(),n("div",it,[e("table",lt,[e("thead",dt,[e("tr",null,[t[20]||(t[20]=e("th",{class:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Référence",-1)),t[21]||(t[21]=e("th",{class:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Client",-1)),t[22]||(t[22]=e("th",{class:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Montant",-1)),e("th",{class:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:t[8]||(t[8]=r=>a.sortBy("start_date"))},[t[19]||(t[19]=p(" Date de début ")),a.sortField==="start_date"?(i(),n("span",ct,l(a.sortDirection==="asc"?"↑":"↓"),1)):w("",!0)]),t[23]||(t[23]=e("th",{class:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Durée",-1)),t[24]||(t[24]=e("th",{class:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Statut",-1)),t[25]||(t[25]=e("th",{class:"py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions",-1))])]),e("tbody",pt,[(i(!0),n(_,null,F(a.loans,r=>(i(),n("tr",{key:r.id,class:"hover:bg-gray-50"},[e("td",ut,[e("div",gt,"#"+l(r.id),1)]),e("td",xt,[e("div",mt,l(r.client?`${r.client.last_name} ${r.client.first_name}`:"N/A"),1)]),e("td",vt,[e("div",yt,l(a.formatCurrency(r.amount)),1)]),e("td",ft,[e("div",bt,l(a.formatDate(r.start_date)),1)]),e("td",_t,[e("div",wt,l(r.term_months)+" mois",1)]),e("td",ht,[e("span",{class:x([a.getStatusClass(r.status),"px-2 inline-flex text-xs leading-5 font-semibold rounded-full"])},l(a.getStatusLabel(r.status)),3)]),e("td",kt,[e("div",Ct,[C(u,{to:`/loans/${r.id}`,class:"text-primary hover:text-primary-dark"},{default:T(()=>t[26]||(t[26]=[p(" Détails ")])),_:2},1032,["to"]),r.status==="pending"?(i(),n("button",{key:0,onClick:m=>a.approveLoan(r.id),class:"text-green-600 hover:text-green-800"}," Approuver ",8,Tt)):w("",!0)])])]))),128))])]),a.loans.length>0?(i(),n("div",Dt,[e("div",Ft,[e("div",zt,[e("p",Lt,[t[27]||(t[27]=p(" Affichage de ")),e("span",Vt,l((a.pagination.current_page-1)*a.pagination.per_page+1),1),t[28]||(t[28]=p(" à ")),e("span",At,l(Math.min(a.pagination.current_page*a.pagination.per_page,a.pagination.total)),1),t[29]||(t[29]=p(" sur ")),e("span",Pt,l(a.pagination.total),1),t[30]||(t[30]=p(" résultats "))])]),a.pagination.last_page>1?(i(),n("div",St,[e("button",{onClick:t[9]||(t[9]=r=>a.changePage(a.pagination.current_page-1)),disabled:a.pagination.current_page===1,class:x(["relative inline-flex items-center rounded-l-md px-2 py-1 text-xs text-gray-600 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",{"opacity-50 cursor-not-allowed":a.pagination.current_page===1}])}," Précédent ",10,Mt),(i(!0),n(_,null,F(a.getPaginationRange(),r=>(i(),n(_,{key:r},[r!=="..."?(i(),n("button",{key:0,onClick:m=>a.changePage(r),class:x(["relative inline-flex items-center px-3 py-1 text-xs font-semibold ring-1 ring-inset ring-gray-300 focus:z-20 focus:outline-offset-0",r===a.pagination.current_page?"z-10 bg-primary text-white hover:bg-primary-dark":"text-gray-600 hover:bg-gray-50"])},l(r),11,Nt)):(i(),n("span",Bt," ... "))],64))),128)),e("button",{onClick:t[10]||(t[10]=r=>a.changePage(a.pagination.current_page+1)),disabled:a.pagination.current_page===a.pagination.last_page,class:x(["relative inline-flex items-center rounded-r-md px-2 py-1 text-xs text-gray-600 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0",{"opacity-50 cursor-not-allowed":a.pagination.current_page===a.pagination.last_page}])}," Suivant ",10,Et)])):w("",!0)])])):w("",!0)]))])])}const Qt=j(O,[["render",Rt],["__scopeId","data-v-b69a9348"]]);export{Qt as default};
