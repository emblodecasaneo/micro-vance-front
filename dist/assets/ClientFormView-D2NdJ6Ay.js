import{u as N,B as k,L as j,r as g,J as D,o as O,a as _,M as R,c as n,b as e,t as u,x as f,n as d,e as b,F as q,l as U,y as m,z as p,D as B,v as T,m as a}from"./index-CHW42hPp.js";const F={class:"flex items-center justify-between mb-6"},P={class:"flex items-center"},H={class:"text-sm tracking-widest font-medium text-gray-800"},$={key:0,class:"bg-white rounded-lg shadow-sm p-6 text-center"},G={class:"mt-2 text-gray-500"},J={key:1,class:"bg-white rounded-lg shadow-sm overflow-hidden"},K={class:"bg-blue-50 border-l-4 border-blue-400 p-4"},Q={class:"flex"},W={class:"ml-3"},X={class:"text-sm font-light text-blue-800"},Y={class:"text-orange-400"},Z={key:0,class:"bg-red-50 border-l-4 border-red-500 p-4 mb-6"},ee={class:"flex"},se={class:"ml-3"},te={class:"mt-2 text-sm text-red-700 list-disc list-inside"},re={key:1,class:"bg-green-50 border-l-4 border-green-500 p-4 mb-6"},oe={class:"flex"},le={class:"ml-3"},ne={class:"text-sm font-medium text-green-800"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie={class:"space-y-4"},de={class:"space-y-4"},ue={key:0,class:"mt-4"},me={class:"space-y-4"},ce={key:0},pe=["value"],fe={key:1},be={class:"flex justify-end space-x-3 border-t mt-2 border-gray-200 pt-6"},xe=["disabled"],ge={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white inline-block",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},we={__name:"ClientFormView",setup(ve){var E;const A=j(),x=R(),l=N(),i=k(()=>A.name==="ClientEdit"),v=k(()=>A.params.id),z=k(()=>{var r;return((r=l.user)==null?void 0:r.role)==="agent"}),C=g(!0),y=g(!1),c=g(null),w=g(""),V=g([]),t=D({first_name:"",last_name:"",id_card_number:"",profession:"",address:"",phone_number:"",email:"",agent_id:z.value?(E=l.user)==null?void 0:E.id:"",status:"active"});O(async()=>{try{if((l.isAdmin||l.isSuperAdmin)&&await L(),i.value){const r=await _.getClient(v.value);if(r.data&&r.data.status==="success"){const s=r.data.data;t.first_name=s.first_name,t.last_name=s.last_name,t.id_card_number=s.id_card_number,t.profession=s.profession,t.address=s.address,t.phone_number=s.phone_number,t.email=s.email||"",t.agent_id=s.agent_id,t.status=s.status}else throw new Error("Impossible de récupérer les informations du client")}}catch(r){console.error("Erreur lors du chargement des données:",r),i.value&&x.push("/clients")}finally{C.value=!1}});const L=async()=>{try{const r=await _.getOrganizationAgents();r.data&&r.data.status==="success"&&(V.value=r.data.data)}catch(r){console.error("Erreur lors du chargement des agents:",r)}},I=async()=>{y.value=!0,c.value=null,w.value="";try{console.log("Envoi du formulaire client:",{data:t,estAdmin:l.isAdmin,estSuperAdmin:l.isSuperAdmin,estAgent:z.value,organisationId:l.currentOrganizationId,organisation:l.currentOrganizationName});let r;if(i.value?r=await _.updateClient(v.value,t):r=await _.createClient(t),console.log("Réponse API:",r.data),r.data&&r.data.status==="success")w.value=i.value?"Le client a été mis à jour avec succès!":"Le client a été créé avec succès!",i.value?setTimeout(()=>{console.log("Redirection vers les détails du client avec refresh:",Date.now()),x.push({path:`/clients/${v.value}`,query:{refresh:Date.now()}})},1500):(Object.keys(t).forEach(s=>{s!=="agent_id"&&s!=="status"&&(t[s]="")}),setTimeout(()=>{console.log("Redirection vers la liste des clients avec refresh:",Date.now()),x.push({path:"/clients",query:{refresh:Date.now()}})},3e3));else throw new Error("Une erreur est survenue")}catch(r){console.error("Erreur lors de la soumission du formulaire:",r),r.response&&r.response.status===422&&r.response.data.errors?(c.value=r.response.data.errors,console.log("Erreurs de validation:",c.value)):c.value={general:["Une erreur est survenue lors de la soumission du formulaire. Veuillez réessayer."]}}finally{y.value=!1}},M=()=>{i.value?x.push(`/clients/${v.value}`):x.push("/clients")};return(r,s)=>{var S;return a(),n("div",null,[e("div",F,[e("div",P,[e("button",{onClick:M,class:"mr-4 p-2 rounded-full hover:bg-gray-100"},s[9]||(s[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])),e("h1",H,u(i.value?"Modifier le client":"Nouveau client"),1)])]),C.value?(a(),n("div",$,[s[10]||(s[10]=e("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"},null,-1)),e("p",G,u(i.value?"Chargement des informations du client...":"Initialisation du formulaire..."),1)])):(a(),n("div",J,[e("div",K,[e("div",Q,[s[12]||(s[12]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-blue-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})])],-1)),e("div",W,[e("p",X,[s[11]||(s[11]=d(" Ce client sera automatiquement associé à l'organisation ")),e("strong",Y,u(b(l).currentOrganizationName),1),d(". "+u(((S=b(l).user)==null?void 0:S.role)==="agent"?"Vous serez automatiquement défini comme l'agent responsable.":""),1)])])])]),c.value&&Object.keys(c.value).length>0?(a(),n("div",Z,[e("div",ee,[s[14]||(s[14]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",se,[s[13]||(s[13]=e("h3",{class:"text-sm font-medium text-red-800"}," Veuillez corriger les erreurs suivantes: ",-1)),e("ul",te,[(a(!0),n(q,null,U(c.value,(o,h)=>(a(),n("li",{key:h},u(o[0]),1))),128))])])])])):f("",!0),w.value?(a(),n("div",re,[e("div",oe,[s[15]||(s[15]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-green-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),e("div",le,[e("p",ne,u(w.value),1)])])])):f("",!0),e("form",{onSubmit:T(I,["prevent"]),class:"p-6"},[e("div",ae,[e("div",null,[s[20]||(s[20]=e("h2",{class:"text-xs font-medium text-gray-500 mb-4"},"Informations personnelles",-1)),e("div",ie,[e("div",null,[s[16]||(s[16]=e("label",{for:"first_name",class:"block text-xs font-normal text-gray-500 mb-1"},[d("Prénom "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{type:"text",id:"first_name","onUpdate:modelValue":s[0]||(s[0]=o=>t.first_name=o),class:"block w-full text-xs focus:ring-primary focus:border-primary focus:outline-none rounded-md h-[34px] px-3 border border-gray-300",required:""},null,512),[[p,t.first_name]])]),e("div",null,[s[17]||(s[17]=e("label",{for:"last_name",class:"block text-xs font-normal text-gray-500 mb-1"},[d("Nom "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{type:"text",id:"last_name","onUpdate:modelValue":s[1]||(s[1]=o=>t.last_name=o),class:"block w-full text-xs focus:ring-primary focus:border-primary focus:outline-none rounded-md h-[34px] px-3 border border-gray-300",required:""},null,512),[[p,t.last_name]])]),e("div",null,[s[18]||(s[18]=e("label",{for:"id_card_number",class:"block text-xs font-normal text-gray-500 mb-1"},[d("Numéro de carte d'identité "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{type:"text",id:"id_card_number","onUpdate:modelValue":s[2]||(s[2]=o=>t.id_card_number=o),class:"block w-full text-xs focus:ring-primary focus:border-primary focus:outline-none rounded-md h-[34px] px-3 border border-gray-300",required:""},null,512),[[p,t.id_card_number]])]),e("div",null,[s[19]||(s[19]=e("label",{for:"profession",class:"block text-xs font-normal text-gray-500 mb-1"},[d("Profession "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{type:"text",id:"profession","onUpdate:modelValue":s[3]||(s[3]=o=>t.profession=o),class:"block w-full text-xs focus:ring-primary focus:border-primary focus:outline-none rounded-md h-[34px] px-3 border border-gray-300",required:""},null,512),[[p,t.profession]])])])]),e("div",null,[s[28]||(s[28]=e("h2",{class:"text-xs font-medium text-gray-500 mb-4"},"Informations de contact",-1)),e("div",de,[e("div",null,[s[21]||(s[21]=e("label",{for:"phone_number",class:"block text-xs font-normal text-gray-500 mb-1"},[d("Téléphone "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{type:"text",id:"phone_number","onUpdate:modelValue":s[4]||(s[4]=o=>t.phone_number=o),class:"block w-full text-xs focus:ring-primary focus:border-primary focus:outline-none rounded-md h-[34px] px-3 border border-gray-300",required:""},null,512),[[p,t.phone_number]])]),e("div",null,[s[22]||(s[22]=e("label",{for:"email",class:"block text-xs font-normal text-gray-500 mb-1"},"Email",-1)),m(e("input",{type:"email",id:"email","onUpdate:modelValue":s[5]||(s[5]=o=>t.email=o),class:"block w-full text-xs focus:ring-primary focus:border-primary focus:outline-none rounded-md h-[34px] px-3 border border-gray-300"},null,512),[[p,t.email]])]),e("div",null,[s[23]||(s[23]=e("label",{for:"address",class:"block text-xs font-normal text-gray-500 mb-1"},[d("Adresse "),e("span",{class:"text-red-500"},"*")],-1)),m(e("input",{id:"address","onUpdate:modelValue":s[6]||(s[6]=o=>t.address=o),rows:"3",class:"block w-full text-xs focus:ring-primary focus:border-primary focus:outline-none rounded-md h-[34px] px-3 border border-gray-300",required:""},null,512),[[p,t.address]])])]),b(l).isAdmin||b(l).isSuperAdmin||i.value?(a(),n("div",ue,[e("div",me,[b(l).isAdmin||b(l).isSuperAdmin?(a(),n("div",ce,[s[25]||(s[25]=e("label",{for:"agent_id",class:"block text-xs font-normal text-gray-500 mb-1"},[d("Gertionnaire assigné "),e("span",{class:"text-red-500"},"*")],-1)),m(e("select",{id:"agent_id","onUpdate:modelValue":s[7]||(s[7]=o=>t.agent_id=o),class:"block w-full text-primary-gray text-xs focus:ring-primary focus:border-primary focus:outline-none rounded-md h-[34px] px-3 border border-gray-300",required:""},[s[24]||(s[24]=e("option",{value:""},"Sélectionnez un agent",-1)),(a(!0),n(q,null,U(V.value,o=>{var h;return a(),n("option",{key:o.id,value:o.id},u(o.name)+" "+u(((h=o.pivot)==null?void 0:h.role)==="admin"?"(Admin)":"(Agent)"),9,pe)}),128))],512),[[B,t.agent_id]])])):f("",!0),i.value?(a(),n("div",fe,[s[27]||(s[27]=e("label",{for:"status",class:"block text-sm font-normal text-gray-500 mb-1"},"Statut",-1)),m(e("select",{id:"status","onUpdate:modelValue":s[8]||(s[8]=o=>t.status=o),class:"block w-full py-2 px-3 border font-normal text-gray-800 border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-primary focus:border-primary sm:text-sm"},s[26]||(s[26]=[e("option",{value:"active"},"Actif",-1),e("option",{value:"inactive"},"Inactif",-1),e("option",{value:"blacklisted"},"Liste noire",-1)]),512),[[B,t.status]])])):f("",!0)])])):f("",!0)])]),e("div",be,[e("button",{type:"button",onClick:M,class:"py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-normal text-gray-500 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary"}," Annuler "),e("button",{type:"submit",class:"py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary",disabled:y.value},[y.value?(a(),n("svg",ge,s[29]||(s[29]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):f("",!0),d(" "+u(i.value?"Mettre à jour":"Créer le client"),1)],8,xe)])],32)]))])}}};export{we as default};
