import{u as V,r as c,B as j,o as z,c as a,b as e,t as i,e as m,F as B,l as S,v as A,y as g,z as b,x as h,n as D,a as P,m as l,q as N}from"./index-CHW42hPp.js";import{u as U}from"./toast-DZktrDzS.js";const H={class:"bg-white shadow rounded-lg p-6"},I={class:"flex flex-col md:flex-row gap-8"},E={class:"md:w-1/3"},F={class:"mb-6 flex flex-col items-center"},O={class:"w-28 h-28 bg-primary rounded-full text-white flex items-center justify-center text-4xl font-bold mb-4"},T={class:"text-sm text-gray-900 font-semibold"},q={class:"text-gray-500 text-sm"},R={class:"bg-primary bg-opacity-10 text-primary px-2 py-1 rounded-full text-xs mt-2"},$={class:"mt-6"},G={key:0,class:"space-y-3"},J={class:"flex items-center"},K={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Q={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},W={key:2,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},X={class:"flex-grow"},Y={class:"text-xs font-medium text-gray-800"},Z={class:"text-xs text-gray-500"},ee={key:1,class:"text-sm text-gray-500 italic"},te={class:"md:w-2/3"},se={class:"space-y-4"},re=["value"],oe={class:"pt-4"},ae=["disabled"],le={class:"flex items-center"},ne={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ce={__name:"ProfileView",setup(ie){const r=V(),p=U(),u=c(!1),d=c(null),v=c([]),n=c({name:"",email:""}),w=j(()=>{var t;const s=(t=r.user)==null?void 0:t.role;return s==="super_admin"?"Super Admin":s==="admin"?"Administrateur":s==="agent"?"Agent":s}),_=async()=>{try{const s=await P.getLastLogins();s.data.status==="success"&&(v.value=s.data.data)}catch(s){console.error("Erreur lors de la récupération des dernières connexions:",s)}},k=s=>new Date(s).toLocaleString("fr-FR",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"}),M=s=>{const t=[];return s.device_type&&t.push(s.device_type==="desktop"?"Ordinateur":s.device_type==="mobile"?"Mobile":s.device_type==="tablet"?"Tablette":s.device_type),s.ip_address&&t.push(`IP: ${s.ip_address}`),s.location&&t.push(s.location),t.join(" · ")||"Information non disponible"},C=s=>s==="mobile"?"bg-blue-100 text-blue-600":s==="tablet"?"bg-purple-100 text-purple-600":"bg-green-100 text-green-600";z(()=>{r.user&&(n.value.name=r.user.name,n.value.email=r.user.email),_()});const L=async()=>{u.value=!0,d.value=null;try{await r.updateProfile({name:n.value.name})?(n.value.name=r.user.name,p.success("Profil mis à jour avec succès !")):(d.value=r.error||"Une erreur est survenue lors de la mise à jour",p.error(d.value))}catch(s){d.value=s.message||"Une erreur est survenue",p.error(d.value)}finally{u.value=!1}};return(s,t)=>{var f,x,y;return l(),a("div",H,[t[12]||(t[12]=e("h1",{class:"text-sm font-semibold text-gray-500 mb-6"},"Profile",-1)),e("div",I,[e("div",E,[e("div",F,[e("div",O,i((f=m(r).user)==null?void 0:f.name.charAt(0).toUpperCase()),1),e("h2",T,i((x=m(r).user)==null?void 0:x.name),1),e("p",q,i((y=m(r).user)==null?void 0:y.email),1),e("span",R,i(w.value),1)]),e("div",$,[t[5]||(t[5]=e("h1",{class:"text-sm font-semibold text-gray-500 mb-6"},"Dernières connexions",-1)),v.value.length>0?(l(),a("div",G,[(l(!0),a(B,null,S(v.value,o=>(l(),a("div",{key:o.id,class:"bg-gray-50 p-3 rounded-md"},[e("div",J,[e("div",{class:N(["p-2 rounded-full mr-3",C(o.device_type)])},[o.device_type==="desktop"?(l(),a("svg",K,t[2]||(t[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)]))):o.device_type==="mobile"?(l(),a("svg",Q,t[3]||(t[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)]))):o.device_type==="tablet"?(l(),a("svg",W,t[4]||(t[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 18h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"},null,-1)]))):h("",!0)],2),e("div",X,[e("div",Y,i(k(o.logged_at)),1),e("div",Z,i(M(o)),1)])])]))),128))])):(l(),a("div",ee," Aucun historique de connexion disponible "))])]),e("div",te,[e("form",{onSubmit:A(L,["prevent"])},[e("div",se,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-500 mb-1"},"Nom complet",-1)),g(e("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>n.value.name=o),class:"w-full rounded-md border-gray-300 shadow-sm focus:border-gray-200 py-1 px-2"},null,512),[[b,n.value.name]])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email",-1)),g(e("input",{type:"email","onUpdate:modelValue":t[1]||(t[1]=o=>n.value.email=o),class:"w-full rounded-md border-gray-300 px-2 py-1 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-20 bg-gray-50",disabled:""},null,512),[[b,n.value.email]]),t[8]||(t[8]=e("p",{class:"mt-1 text-xs text-gray-500"},"L'email ne peut pas être modifié.",-1))]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Organisation",-1)),e("input",{type:"text",value:m(r).currentOrganizationName,class:"w-full rounded-md border-gray-300 px-2 py-1 shadow-sm focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-20 bg-gray-50",disabled:""},null,8,re)]),e("div",oe,[e("button",{type:"submit",class:"bg-primary text-white rounded-md px-4 py-2 hover:bg-primary-dark",disabled:u.value},[e("div",le,[u.value?(l(),a("svg",ne,t[10]||(t[10]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):h("",!0),t[11]||(t[11]=D(" Mettre à jour "))])],8,ae)])])],32)])])])}}};export{ce as default};
